<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <meta name="theme-color" content="#f8c400" />

    <meta name="twitter:creator" content="@tim_deschryver" />
    <meta name="twitter:site" content="@tim_deschryver" />

    %sapper.base%

    <link
      rel="alternate"
      type="application/rss+xml"
      title="Tim Deschryver"
      href="/blog/rss.xml"
    />
    <link rel="stylesheet" href="global.css" />
    <link rel="stylesheet" prism href="prism.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Comfortaa:300,400,500,600,700"
      rel="stylesheet"
    />

    <link rel="manifest" href="manifest.json" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/favicons/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicons/favicon-16x16.png"
    />
    <link rel="icon" type="image/ico" href="favicon.ico" />

    <title>Tim Deschryver</title>
    %sapper.styles% %sapper.head%
  </head>
  <body data-theme="custom">
    <script>
      document.body.className =
        (localStorage && localStorage.getItem('__theme')) ||
        (window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
          ? 'sunset'
          : 'sunrise')

      window.addEventListener('change-color', evt => {
        let key = evt.detail.key
        let color = evt.detail.value
        document.documentElement.style.setProperty(key, hexToRGB(color, 1))
        localStorage.setItem(key, color)

        if (key === '--prime-color') {
          document.documentElement.style.setProperty(
            key + '-01',
            hexToRGB(color, 0.1),
          )
          document.documentElement.style.setProperty(
            key + '-03',
            hexToRGB(color, 0.3),
          )
        }
      })

      window.addEventListener('change-code-theme', evt => {
        let theme = evt.detail.value
        document.body.dataset.theme = theme
        localStorage.setItem('code-theme', theme)
      })

      function hexToRGB(color, alpha) {
        if (!color.startsWith('#')) {
          return color
        }

        let r = parseInt(color.slice(1, 3), 16),
          g = parseInt(color.slice(3, 5), 16),
          b = parseInt(color.slice(5, 7), 16)

        if (alpha) {
          return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + alpha + ')'
        } else {
          return 'rgb(' + r + ', ' + g + ', ' + b + ')'
        }
      }

      for (let i = 0; i < localStorage.length; i++) {
        let key = localStorage.key(i)
        if (key === 'code-theme') {
          let value = localStorage.getItem(key)
          window.dispatchEvent(
            new CustomEvent('change-code-theme', {
              detail: {
                value,
              },
            }),
          )
          continue
        }

        if (!key.startsWith('--')) {
          continue
        }

        let value = localStorage.getItem(key)
        if (!value) {
          continue
        }

        window.dispatchEvent(
          new CustomEvent('change-color', {
            detail: {
              key,
              value,
            },
          }),
        )
      }

      function changeTheme(theme) {
        let newlink = document.createElement('link')
        newlink.setAttribute('rel', 'stylesheet')
        newlink.setAttribute('prism', '')
        newlink.setAttribute('type', 'text/css')
        newlink.setAttribute('href', `prism-${theme}.css`)

        document.querySelector('[prism]').replaceWith(newlink)
      }
    </script>
    <div id="sapper">%sapper.html%</div>

    %sapper.scripts%
  </body>
</html>
